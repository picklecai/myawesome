[Posts by åˆ˜å¿—å†› - FooFish-Pythonä¹‹ç¦…](https://foofish.net/author/liu-zhi-jun.html)


# è£…é¥°å™¨

æœ¬æ¥æ˜¯å¬è¯´è£…é¥°å™¨æ¯”è¾ƒéš¾æ‡‚ï¼Œåˆå­¦è€…å¦‚æœä¸å°å¿ƒé™·è¿›å»ï¼Œä¼šç¨€é‡Œç³Šæ¶‚å‡ºä¸æ¥ã€‚æ‰€ä»¥å¹¶æ²¡æœ‰åˆ»æ„å»æ‰¾ã€‚ä½†æ˜¯ä»Šå¤©çœ‹åˆ°bottleä¸­ç”¨äº†routeå‰æœ‰@ã€‚è§£è¯´è€…è¯´è¿™æ˜¯è£…é¥°å™¨ï¼Œäºæ˜¯ä¸€æ—¶æ‰‹ç—’æœäº†ä¸€ä¸‹ï¼Œæ²¡æƒ³åˆ°æœåˆ°è¿™ä¸ªï¼š  

[ç†è§£ Python è£…é¥°å™¨çœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† - FooFish-Pythonä¹‹ç¦…](https://foofish.net/python-decorator.html)

åˆ˜å¿—å†›äº²è‡ªå†™çš„ï¼Œæœç„¶æµ…æ˜¾ã€‚

## 1. æ¼”åŒ–è¿‡ç¨‹  

```
def foo():
    print("I am foo.")

```
æ–°å¢ä¸€ä¸ªéœ€æ±‚ï¼š**å¸Œæœ›å¯ä»¥è®°å½•ä¸‹å‡½æ•°çš„æ‰§è¡Œæ—¥å¿—ï¼Œ**  

### æ–¹æ³•1:  

```
import logging

def foo():
	print("I am foo.")
	logging.info('foo is running')
```
å¦‚æœå‡½æ•° bar()ã€bar2() ä¹Ÿæœ‰ç±»ä¼¼çš„éœ€æ±‚ï¼Œæ€ä¹ˆåšï¼Ÿå†å†™ä¸€ä¸ª logging åœ¨ bar å‡½æ•°é‡Œï¼Ÿè¿™æ ·å°±é€ æˆå¤§é‡é›·åŒçš„ä»£ç ã€‚

### æ–¹æ³•2:

```
import logging

def using_logging(func):    
    logging.warning('%s is running.'%func.__name__)
    func()

def foo():
    print('I am foo.')
    
using_logging(foo)
```

è¿™æ˜¯å¦å¤–æ„é€ ä¸€ä¸ªå‡½æ•°ï¼Œæ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°using_loggingï¼Œèƒ½å¤§é‡å‡å°‘é‡å¤ä»£ç ã€‚  

é—®é¢˜æ˜¯ï¼šè°ƒç”¨çš„æ—¶å€™ä¸å†æ˜¯è°ƒç”¨çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘ foo å‡½æ•°ï¼Œè€Œæ˜¯æ¢æˆäº† use_logging å‡½æ•°ï¼Œè¿™å°±ç ´åäº†åŸæœ‰çš„ä»£ç ç»“æ„ï¼Œ ç°åœ¨æˆ‘ä»¬ä¸å¾—ä¸æ¯æ¬¡éƒ½è¦æŠŠåŸæ¥çš„é‚£ä¸ª foo å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™ use_logging å‡½æ•°ã€‚


### æ–¹æ³•3:è£…é¥°å™¨  

```
import logging

def using_logging(func): 
    def wrapper():
        logging.warning('%s is running.'%func.__name__)
        return func()
    return wrapper

def foo():
    print('I am foo.')
    
foo = using_logging(foo)
foo()
```
> use_logging å°±æ˜¯ä¸€ä¸ªè£…é¥°å™¨ï¼Œå®ƒä¸€ä¸ªæ™®é€šçš„å‡½æ•°ï¼Œå®ƒæŠŠæ‰§è¡ŒçœŸæ­£ä¸šåŠ¡é€»è¾‘çš„å‡½æ•° func åŒ…è£¹åœ¨å…¶ä¸­ï¼Œçœ‹èµ·æ¥**åƒ foo è¢« use_logging è£…é¥°äº†**ä¸€æ ·ï¼Œuse_logging è¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„åå­—å« wrapperã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ**å‡½æ•°è¿›å…¥å’Œé€€å‡ºæ—¶ ï¼Œè¢«ç§°ä¸ºä¸€ä¸ªæ¨ªåˆ‡é¢**ï¼Œè¿™ç§ç¼–ç¨‹æ–¹å¼è¢«ç§°ä¸º**é¢å‘åˆ‡é¢**çš„ç¼–ç¨‹ã€‚

## 2. è¯­æ³•ç³–  

### 2.1 å¥½åƒçš„â€œç³–ğŸ¬â€

çœ‹åˆ°ç³–è¿™ä¸ªè¯æ€»æ˜¯è®©äººæ„Ÿè§‰æ¿€åŠ¨çš„ã€‚  

æ”¹ç”¨äº†è¯­æ³•ç³–åï¼Œä¸Šé¢çš„ä»£ç å°±å˜æˆï¼š  

```
import logging

def using_logging(func): 
    def wrapper():
        logging.warning('%s is running.'%func.__name__)
        return func()
    return wrapper

@using_logging
def foo():
    print('I am foo.')
    
#foo = using_logging(foo)
foo()
```
å¯ä»¥çœ‹å‡ºæ˜¯çœç•¥äº†`foo = using_logging(foo)`

> ç°åœ¨ç›´æ¥è°ƒç”¨ foo() å³å¯å¾—åˆ°æƒ³è¦çš„ç»“æœã€‚ä½ ä»¬çœ‹åˆ°äº†æ²¡æœ‰ï¼Œfoo() å‡½æ•°ä¸éœ€è¦åšä»»ä½•ä¿®æ”¹ï¼Œåªéœ€åœ¨å®šä¹‰çš„åœ°æ–¹åŠ ä¸Šè£…é¥°å™¨ï¼Œè°ƒç”¨çš„æ—¶å€™è¿˜æ˜¯å’Œä»¥å‰ä¸€æ ·ï¼Œå¦‚æœæˆ‘ä»¬æœ‰å…¶ä»–çš„ç±»ä¼¼å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­è°ƒç”¨è£…é¥°å™¨æ¥ä¿®é¥°å‡½æ•°ï¼Œè€Œä¸ç”¨é‡å¤ä¿®æ”¹å‡½æ•°æˆ–è€…å¢åŠ æ–°çš„å°è£…ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±**æé«˜äº†ç¨‹åºçš„å¯é‡å¤åˆ©ç”¨æ€§**ï¼Œå¹¶**å¢åŠ äº†ç¨‹åºçš„å¯è¯»æ€§**ã€‚

> è£…é¥°å™¨åœ¨ Python ä½¿ç”¨å¦‚æ­¤æ–¹ä¾¿éƒ½è¦å½’å› äº **Python çš„å‡½æ•°èƒ½åƒæ™®é€šçš„å¯¹è±¡ä¸€æ ·èƒ½ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°ï¼Œå¯ä»¥è¢«èµ‹å€¼ç»™å…¶ä»–å˜é‡ï¼Œå¯ä»¥ä½œä¸ºè¿”å›å€¼ï¼Œå¯ä»¥è¢«å®šä¹‰åœ¨å¦å¤–ä¸€ä¸ªå‡½æ•°å†…ã€‚** 


### 2.2 å‡çº§ç‰ˆï¼šå‡½æ•°æœ‰å‚æ•°  

åªæœ‰1ä¸ªå‚æ•°ï¼šç›´æ¥æŠŠå‚æ•°åŠ å…¥wrapperã€‚  

```
import logging

def using_logging(func): 
    def wrapper(arg):
        logging.warning('%s is running.'%func.__name__)
        return func(arg)
    return wrapper

@using_logging
def foo(arg):
    print('I am foo.')
    
foo()
```

æœ‰å¤šä¸ªå‚æ•°ï¼Œç”¨*args

```
import logging

def using_logging(func): 
    def wrapper(*args):
        logging.warning('%s is running.'%func.__name__)
        return func(*args)
    return wrapper

@using_logging
def foo(arg1, arg2, arg3,):
    print('I am foo.')
    
foo()
```

æœ‰å…³é”®å­—å‚æ•°ï¼Œç”¨*kwargs

```
import logging

def using_logging(func): 
    def wrapper(*args, **kwargs):
        logging.warning('%s is running.'%func.__name__)
        return func(*args, **kwargs)
    return wrapper

@using_logging
def foo(name, age=None, height=None):
    print("I am %s, age %s, height %s" % (name, age, height))
    
foo()
```
**argsæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œkwargsä¸€ä¸ªå­—å…¸**

### 2.3 å‡çº§ç‰ˆï¼šè£…é¥°å™¨æœ‰å‚æ•°  

```
def use_logging(level):
    def decorator(func):
        def wrapper(*args, **kwargs):
            if level == "warn":
                logging.warn("%s is running" % func.__name__)
            elif level == "info":
                logging.info("%s is running" % func.__name__)
            return func(*args)
        return wrapper

    return decorator

@use_logging(level="warn")
def foo(name='foo'):
    print("i am %s" % name)

foo('foo')
```
æ—¥å¿—åŠŸèƒ½å¸¦ç­‰çº§ã€‚

### 2.4 å¤šä¸ªè£…é¥°å™¨  

ä¸€ä¸ªå‡½æ•°è¿˜å¯ä»¥åŒæ—¶å®šä¹‰å¤šä¸ªè£…é¥°å™¨ï¼Œæ¯”å¦‚ï¼š

```
@a
@b
@c
def f ():
    pass
```

å®ƒçš„æ‰§è¡Œé¡ºåºæ˜¯ä»é‡Œåˆ°å¤–ï¼Œæœ€å…ˆè°ƒç”¨æœ€é‡Œå±‚çš„è£…é¥°å™¨ï¼Œæœ€åè°ƒç”¨æœ€å¤–å±‚çš„è£…é¥°å™¨ï¼Œå®ƒç­‰æ•ˆäº  

```
f = a(b(c(f)))
```

